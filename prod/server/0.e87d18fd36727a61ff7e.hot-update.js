exports.id=0,exports.modules={"./src/server/index.js":function(e,t,n){"use strict";n.r(t);var o=n("./build/contracts/FlightSuretyApp.json"),s=n("./build/contracts/FlightSuretyData.json"),c=n("./src/server/config.json"),r=n("web3"),a=n.n(r),i=n("express"),l=n.n(i),u=n("cors"),d=n.n(u),f=c.localhost,h=new a.a(new a.a.providers.WebsocketProvider(f.url.replace("http","ws")));h.eth.defaultAccount=h.eth.accounts[0];var p=new h.eth.Contract(o.abi,f.appAddress),g=new h.eth.Contract(s.abi,f.dataAddress),v=[],m=[],E=10,A=l()();A.options("*",d()({origin:"http://localhost:8000",optionsSuccessStatus:200})),A.use(d()({origin:"http://localhost:8000",optionsSuccessStatus:200})),A.listen(80,(function(){console.log("CORS-enabled web server listening on port 80")})),A.get("/api/status/:status",(function(e,t){var n="Status changed to: ";switch(e.params.status){case"10":E=10,n=n.concat("ON TIME");break;case"20":E=20,n=n.concat("LATE AIRLINE");break;case"30":E=30,n=n.concat("LATE WEATHER");break;case"40":E=40,n=n.concat("LATE TECHNICAL");break;case"50":E=50,n=n.concat("LATE OTHER");break;default:E=0,n=n.concat("UNKNOWN")}t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),t.setHeader("Access-Control-Allow-Headers","X-Requested-With,content-type"),t.setHeader("Access-Control-Allow-Credentials",!0),t.send({message:n})})),p.events.OracleRequest({fromBlock:"latest"},(function(e,t){e&&console.log(e),console.log(t);var n=t.returnValues.index;console.log("Triggered index: ".concat(n));var o=0;m.forEach((function(e){var s=v[o];e[0]!=n&&e[1]!=n&&e[2]!=n||(console.log("Oracle: ".concat(s," triggered. Indexes: ").concat(e,".")),function(e,t,n,o,s){var c={index:t,airline:n,flight:o,timestamp:s,statusCode:E};p.methods.submitOracleResponse(t,n,o,s,E).send({from:e,gas:5e5,gasPrice:2e7},(function(e,t){e&&console.log(e,c)})),20==E&&g.methods.creditInsurees(o).call({from:e},(function(e,t){e?console.log(e,c):console.log("Credit set for insurees")}))}(s,n,t.returnValues.airline,t.returnValues.flight,t.returnValues.timestamp)),o++}))})),g.events.allEvents({fromBlock:"latest"},(function(e,t){e?(console.log("error"),console.log(e)):(console.log("event:"),console.log(t))})),new Promise((function(e,t){h.eth.getAccounts().then((function(e){v=e.slice(20,45)})).catch((function(e){t(e)})).then((function(){e(v)}))})).then((function(e){(function(e){return new Promise((function(t,n){p.methods.REGISTRATION_FEE().call().then((function(o){for(var s=function(t){p.methods.registerOracle().send({from:e[t],value:o,gas:5e6,gasPrice:2e7}).then((function(){p.methods.getMyIndexes().call({from:e[t]}).then((function(n){console.log("Oracle ".concat(t," Registered at ").concat(e[t]," with [").concat(n,"] indexes.")),m.push(n)})).catch((function(e){n(e)}))})).catch((function(e){n(e)}))},c=0;c<25;c++)s(c);t(m)})).catch((function(e){n(e)}))}))})(e).catch((function(e){console.log(e.message)}))}));var b=A;function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n("express");var T=n("morgan"),x=n("body-parser");new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=b,this.initExpress(),this.initExpressMiddleWare(),this.initControllers(),this.start()}var t,n,o;return t=e,(n=[{key:"initExpress",value:function(){this.app.set("port",3e3)}},{key:"initExpressMiddleWare",value:function(){this.app.use(T("dev")),this.app.use(x.urlencoded({extended:!0})),this.app.use(x.json())}},{key:"initControllers",value:function(){}},{key:"start",value:function(){var e=this;this.app.listen(this.app.get("port"),(function(){console.log("Server Listening for port: ".concat(e.app.get("port")))}))}}])&&w(t.prototype,n),o&&w(t,o),e}())}};